---
import Layout from '../../layouts/Layout.astro';
import type { Case, Evidence, Connection } from '../../types/index';

// Import JSON with proper typing
const casesData: Case[] = await import('../../data/cases.json').then(m => m.default);

// Find the specific case
const caseData = casesData.find(c => c.id === '01');
if (!caseData) {
  throw new Error('Case 01 not found');
}

const title = `${caseData.title} - Shadow Protocol`;
---

<Layout title={title}>
  <main id="main-content" class="case-detail min-h-screen">
    <a class="back-btn" href="/dossier" aria-label="Back to Dossier">← BACK TO DOSSIER</a>
    
    <div class="case-content max-w-4xl mx-auto p-8 pt-20">
      <div class="case-header text-center mb-12">        
        <div class="case-number text-yellow-400 font-mono text-lg mb-2">CASE FILE #{caseData.id}</div>
        <h1 class="text-4xl font-bold text-yellow-400 mb-4">{caseData.title.split(': ')[1] || caseData.title}</h1>
        <p class="text-xl text-gray-300 mb-2">Date: {new Date(caseData.date).toLocaleDateString()}</p>
        <p class="text-gray-400 italic">"{caseData.content.quote}"</p>
      </div>

      <div class="case-classification bg-red-900/20 border border-red-400/30 p-4 mb-8 text-center">
        <div class="text-red-400 font-mono text-sm">CLASSIFICATION: TOP SECRET</div>
        <div class="text-red-300 text-xs mt-1">ACCESS LEVEL: SHADOW PROTOCOL PERSONNEL ONLY</div>
      </div>

      <div class="case-sections space-y-12">
        <section class="case-summary">
          <h2 class="text-2xl font-bold text-yellow-400 mb-6">Mission Summary</h2>
          <div class="text-gray-300 space-y-4">
            {caseData.content.missionSummary.map((paragraph: string) => (
              <p>{paragraph}</p>
            ))}
          </div>
        </section>

        <section class="case-evidence">
          <h2 class="text-2xl font-bold text-yellow-400 mb-6">Key Evidence</h2>
          <div class="evidence-grid grid md:grid-cols-2 gap-6">
            {caseData.content.evidence.map((evidence: Evidence) => (
              <div class="evidence-item bg-yellow-400/5 border border-yellow-400/20 p-4">
                <h3 class="text-yellow-400 font-bold mb-2">{evidence.title}</h3>
                <p class="text-gray-300 text-sm">{evidence.description}</p>
                <div class="evidence-tags mt-2">
                  {evidence.tags.map((tag: string) => (
                    <span class="text-xs bg-yellow-400/10 px-2 py-1 rounded mr-2">{tag}</span>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </section>

        <section class="case-outcome">
          <h2 class="text-2xl font-bold text-yellow-400 mb-6">Mission Outcome</h2>
          <div class="outcome-status bg-green-900/20 border border-green-400/30 p-6 mb-6">
            <div class="text-green-400 font-bold text-lg">STATUS: {caseData.content.outcome.status}</div>
            <div class="text-green-300 mt-2">{caseData.content.outcome.statusDescription}</div>
          </div>
          
          <div class="text-gray-300 space-y-4">
            {caseData.content.outcome.details.map((detail: string) => (
              <p>{detail}</p>
            ))}
          </div>
        </section>

        <section class="case-connections">
          <h2 class="text-2xl font-bold text-yellow-400 mb-6">Connected Cases</h2>
          <div class="connections-grid grid md:grid-cols-3 gap-4">
            {caseData.content.connections.map((connection: Connection) => (
              <a href={`/case/${connection.caseId}`} class="connection-card bg-gray-900/50 border border-yellow-400/20 p-4 hover:border-yellow-400/50 transition-all">
                <div class="text-yellow-400 text-sm font-mono">CASE #{connection.caseId}</div>
                <div class="text-white font-bold">{connection.title}</div>
                <div class="text-gray-400 text-xs mt-1">→ {connection.connection}</div>
              </a>
            ))}
          </div>
        </section>
      </div>
    </div>
  </main>
</Layout>

<style>
  .case-detail {
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
  }
  
  .evidence-item {
    transition: all 0.3s ease;
  }
  
  .evidence-item:hover {
    border-color: rgba(255, 215, 0, 0.4);
    background: rgba(255, 215, 0, 0.08);
  }
  
  .connection-card {
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .connection-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.05), transparent);
    transition: left 0.5s;
  }
  
  .connection-card:hover::before {
    left: 100%;
  }
  
  .connection-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.1);
  }
</style>