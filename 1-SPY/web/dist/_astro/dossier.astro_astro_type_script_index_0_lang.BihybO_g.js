(function(){const f=document.querySelector(".dossier-main"),m=document.querySelector(".dossier-content"),d=document.getElementById("cases-grid"),p=document.getElementById("decrypt-percent"),w=document.getElementById("decrypt-line"),a=document.querySelector(".access-panel");if(!f||!d||!a)return;let l=null;function y(n=6e3){return l||(l=new Promise(t=>{if(!p||!w){t(),l=null;return}let e=0;p.textContent="0",w.style.width="0%";const i=performance.now(),r=Math.max(500,n);function o(s){const c=Math.min(1,(s-i)/r);e=Math.floor(c*100),p.textContent=String(e),w.style.width=e+"%",c<1?requestAnimationFrame(o):(p.textContent="100",w.style.width="100%",setTimeout(()=>{l=null,t()},200))}requestAnimationFrame(o)}),l)}function k(){f.classList.remove("loading"),a&&(a.style.opacity="0",a.style.pointerEvents="none",a.style.transition="opacity 0.35s ease",setTimeout(()=>{a.style.display="none"},400)),m&&(m.style.transition="opacity 0.45s ease",m.style.opacity="1",m.style.pointerEvents="auto")}function _(n){d.innerHTML="";const t=document.createElement("div");t.className="skeleton-grid";for(let e=0;e<n;e++){const i=document.createElement("div");i.className="skeleton-node",i.innerHTML=`
            <div class="timeline-marker" aria-hidden="true">
              <span class="node-dot"></span>
              <span class="node-line"></span>
            </div>
            <div class="timeline-body">
              <div class="node-header">
                <div class="skeleton-line short"></div>
                <div class="skeleton-line xsmall"></div>
              </div>
              <div class="skeleton-line medium"></div>
              <div class="skeleton-line medium"></div>
              <div class="skeleton-line small"></div>
            </div>
          `,t.appendChild(i)}d.appendChild(t),d.setAttribute("aria-busy","true")}function S(n){d.innerHTML="",(n||[]).forEach(function(t){const e=document.createElement("article");e.className="timeline-node case-card",e.setAttribute("data-year",t.year),e.tabIndex=0;const i=document.createElement("div");i.className="timeline-marker",i.setAttribute("aria-hidden","true");const r=document.createElement("span");r.className="node-dot";const o=document.createElement("span");o.className="node-line",i.appendChild(r),i.appendChild(o);const s=document.createElement("div");s.className="timeline-body";const c=document.createElement("div");c.className="node-header";const v=document.createElement("h3");v.id=`case-${t.id}-title`,v.textContent=t.title;const E=document.createElement("div");E.className="node-meta",E.textContent=t.date,c.appendChild(v),c.appendChild(E);const C=document.createElement("p");C.className="node-summary",C.textContent=t.summary;const b=document.createElement("div");b.className="node-tags",(t.tags||[]).forEach(function(q){const A=document.createElement("span");A.className="tag",A.textContent=q,b.appendChild(A)});const g=document.createElement("div");g.className="node-actions";const u=document.createElement("button");u.className="open-case",u.setAttribute("data-target",t.slug),u.setAttribute("aria-label",`Open Case ${t.id}`),u.textContent="Open Case â†’",g.appendChild(u),s.appendChild(c),s.appendChild(C),s.appendChild(b),s.appendChild(g),e.appendChild(i),e.appendChild(s),d.appendChild(e)}),d.setAttribute("aria-busy","false"),L()}function L(){document.querySelectorAll(".open-case").forEach(function(n){n.dataset.wired!=="true"&&(n.dataset.wired="true",n.addEventListener("click",function(t){t.preventDefault();const e=this.getAttribute("data-target");y(800).then(()=>{try{if(window.__swup&&typeof window.__swup.visit=="function"){document.documentElement.setAttribute("data-swup-transition","slide-left"),window.__swup.visit(e);return}if(window.Swup&&typeof window.Swup=="function"){new window.Swup().visit(e);return}}catch{}e&&(window.location.href=e)})}))}),document.querySelectorAll(".timeline-node").forEach(function(n){n.dataset.wired!=="true"&&(n.dataset.wired="true",n.addEventListener("keydown",function(t){if(t.key==="Enter"||t.key===" "){const e=this.querySelector(".open-case");e&&e.click(),t.preventDefault()}}),n.addEventListener("click",function(t){const e=(t.target&&t.target.tagName||"").toLowerCase();if(e==="button"||e==="a"||e==="input")return;const i=this.querySelector(".open-case");i&&i.click()}))})}function N(){const n=Array.from(document.querySelectorAll(".pill"));n.forEach(function(t){t.addEventListener("click",function(){n.forEach(function(i){i.setAttribute("aria-pressed","false")}),this.setAttribute("aria-pressed","true");const e=this.getAttribute("data-year")||"all";document.querySelectorAll(".case-card").forEach(function(i){var r=i,o=r.getAttribute("data-year")||"",s=e==="all"||o===e||e==="1990s"&&o.indexOf("199")===0||e==="2010s"&&o.indexOf("201")===0;r.style.display=s?"":"none"})})})}window.__dossier=window.__dossier||{},window.__dossier.animateLoader=y;async function h(){f.classList.add("loading"),a.style.display="",a.style.opacity="1",a.style.pointerEvents="auto",await y(6e3),_(6),k(),await new Promise(t=>setTimeout(t,260));const n=window.__CASES||[];S(n),N()}function x(){try{const n=window.__swup||window.swup&&window.swup;n&&n.on?n.on("swup:contentReplaced",h):window.addEventListener&&document.addEventListener("swup:contentReplaced",h)}catch{}}h(),x()})();
